function reportPost(a,b){openModal("/scripts/report/getform",!1,!1,function(){"undefined"!=typeof grecaptcha&&0==$("#report-captcha").html().length&&grecaptcha.render("report-captcha",{sitekey:config.reCaptchaPublicKey}),$("#report-post-id").val(b)})}function submitReport(a){if(a.preventDefault(),!("FormData"in window))return toastr.error(messages.oldBrowserWarning,messages.errorOccurred),!1;var b=$(a.target),c=new FormData(a.target),d=$(a.target).html();$(a.target).html(loadingAnimation()),$.ajax({url:b.attr("action"),type:"POST",processData:!1,contentType:!1,data:c}).done(function(){toastr.success(messages.postReported),closeModals()}).fail(function(b,c,e){var f=getErrorMessage(b,e);"418"==b.status?(toastr.info(f),closeModals()):(toastr.error(f,messages.errorOccurred),$(a.target).html(d))})}function deletePost(a){return!!confirm(messages.confirmDeletePost)&&void $.ajax({url:"/scripts/posts/delete",type:"POST",data:{post_id:a}}).done(function(){$p(a).remove(),$("body").hasClass("thread-page")?$t(a).is("*")&&returnToBoard():($t(a).remove(),toastr.success(messages.postDeleted))}).fail(ajaxError)}function deleteFile(a){return!!confirm(messages.confirmDeleteFile)&&void $.ajax({url:"/scripts/posts/deletefile",type:"POST",data:{post_id:a}}).done(function(){$p(a).find("figure").remove(),toastr.success(messages.fileDeleted)}).fail(ajaxError)}function followThread(a){toggleFollowButton(a),$.ajax({url:"/scripts/follow/add",type:"POST",data:{thread_id:a}}).fail(function(b,c,d){ajaxError(b,c,d),toggleFollowButton(a)})}function unfollowThread(a){toggleFollowButton(a),$.ajax({url:"/scripts/follow/remove",type:"POST",data:{thread_id:a}}).fail(function(b,c,d){ajaxError(b,c,d),toggleFollowButton(a)})}function toggleFollowButton(a){var b=$t(a).find(".followbutton");b.hasClass("icon-bookmark-add")?b.removeClass("icon-bookmark-add").addClass("icon-bookmark-remove").attr("onclick","unfollowThread("+a+")"):b.removeClass("icon-bookmark-remove").addClass("icon-bookmark-add").attr("onclick","followThread("+a+")")}function markAllFollowedRead(){$(".icon-bookmark2 .unread-count").hide(),$("h3 .notification-count").hide(),$.ajax({url:"/scripts/follow/markallread",type:"POST"}).fail(function(a,b,c){ajaxError(a,b,c),$(".icon-bookmark2 .unread-count").show(),$("h3 .notification-count").show()})}function hideThread(a,b){b="undefined"==typeof b,$t(a).fadeToggle(),$.ajax({url:"/scripts/threads/hide",type:"POST",data:{thread_id:a}}).done(function(){b&&toastr.success(messages.threadHidden+'<button class="link" onclick="restoreThread('+a+', false)">'+messages.undo+"</button>")}).fail(function(b,c,d){ajaxError(b,c,d),$t(a).stop().show()})}function restoreThread(a,b){b="undefined"==typeof b,$t(a).fadeToggle(),$.ajax({url:"/scripts/threads/restore",type:"POST",data:{thread_id:a}}).done(function(){b&&toastr.success(messages.threadRestored+'<button class="link" onclick="hideThread('+a+', false)">'+messages.undo+"</button>")}).fail(function(b,c,d){ajaxError(b,c,d),$t(a).stop().show()})}function signupForm(a,b){b.preventDefault(),a=$(a),"undefined"!=typeof grecaptcha&&0==$("#signup-captcha").html().length&&grecaptcha.render("signup-captcha",{sitekey:config.reCaptchaPublicKey,size:"compact",theme:"dark"});var c=$("#login"),d=$("#signup-form");"undefined"==typeof c.data("login")&&c.data("login",c.attr("action")),a.data("open")?(c.attr("action",c.data("login")),a.html(messages.signUp),$("#loginbutton").val(messages.logIn),d.slideUp(),d.find("input").val(""),a.data("open",!1)):(c.attr("action",c.data("signup")),a.html(messages.cancel),$("#loginbutton").val(messages.signUp),d.slideDown(),a.data("open",!0))}function openModMenu(a,b){}function toggleThreadLock(a){var b,c;0==$t(a).find("h3 a .icon-lock").length?(b="/scripts/threads/lock",c=function(){$t(a).find("h3 a").prepend('<span class="icon-lock icon"></span>'),toastr.success(messages.threadLocked)}):(b="/scripts/threads/unlock",c=function(){$t(a).find("h3 a .icon-lock").remove(),toastr.success(messages.threadUnlocked)}),updateThread(b,c,a)}function toggleThreadSticky(a){var b,c;0==$t(a).find("h3 a .icon-pushpin").length?(b="/scripts/threads/stick",c=function(){$t(a).find("h3 a").prepend('<span class="icon-pushpin icon"></span>'),toastr.success(messages.threadStickied)}):(b="/scripts/threads/unstick",c=function(){$t(a).find("h3 a .icon-pushpin").remove(),toastr.success(messages.threadUnstickied)}),updateThread(b,c,a)}function updateThread(a,b,c){$.ajax({url:a,type:"POST",data:{thread_id:c}}).done(function(){b()}).fail(ajaxError)}function banForm(a,b){var c={post_id:a};b="boolean"==typeof b&&function(){$p(a).remove()},openModal("/scripts/mod/banform",c,!1,b,!0)}function addBan(a){if(a.preventDefault(),!("FormData"in window))return toastr.error(messages.oldBrowserWarning,messages.errorOccurred),!1;var b=new FormData(a.target),c=$(a.target).html();$(a.target).html(loadingAnimation()),$.ajax({url:a.target.getAttribute("target"),type:"POST",processData:!1,contentType:!1,data:b}).done(function(){toastr.success(messages.banAdded),closeModals()}).fail(function(b,d,e){var f=getErrorMessage(b,e);toastr.error(f,messages.errorOccurred),$(a.target).html(c)})}function setReportChecked(a){$.ajax({url:"/scripts/mod/reports/setchecked",type:"POST",data:{post_id:a}}).done(function(){toastr.success(messages.reportCleared),$p(a).remove()}).fail(ajaxError)}function openModal(a,b,c,d,e){closeModals();var f=$("#modal-root"),g="string"==typeof a;"object"==typeof b&&b!==!1||(b={}),"undefined"!=typeof c&&c!==!1||(c=loadingAnimation());var h;h="undefined"==typeof e?"modal-box":"modal-box full-modal","function"!=typeof d&&(d=function(){});var i='<button class="close-modal close-modal-button icon-cross2"></button>';f.tooltipster({content:c,side:"bottom",animationDuration:0,updateAnimation:null,delay:0,arrow:!1,contentAsHTML:!0,theme:h,zIndex:1001,trigger:"click",interactive:!0,functionReady:function(c,e){g?$.ajax({url:a,type:"POST",data:b}).done(function(a){a=$(a),a.find(".datetime").localizeTimestamp(this),a=a.prop("outerHTML"),c.content(i+a),d()}).fail(ajaxError):d(),$(e.tooltip).on("click",".close-modal",function(){c.close()})},functionAfter:function(a,b){g&&a.content(i+loadingAnimation())}}).tooltipster("open")}function closeModals(){$("#modal-root.tooltipstered").tooltipster("destroy")}function getNotifications(){openModal("/scripts/notifications/get",!1,!1,function(){updateUnreadNotificationCount($(".notifications-list .not-read").length)})}function markNotificationRead(a,b){"undefined"!=typeof b&&b.preventDefault(),$("#n-"+a).removeClass("not-read").addClass("is-read"),$.ajax({url:"/scripts/notifications/markread",type:"POST",data:{id:a}}).done(function(){"undefined"!=typeof b&&(window.location=b.target.getAttribute("href"))}).fail(ajaxError),updateUnreadNotificationCount($(".notification.not-read").length)}function markAllNotificationsRead(){$.ajax({url:"/scripts/notifications/markallread",type:"POST"}).fail(ajaxError),updateUnreadNotificationCount(0)}function updateUnreadNotificationCount(a){var b=$(".unread-notifications");b.html(parseInt(a)),0==a?b.addClass("none"):b.removeClass("none")}function getMoreReplies(a){var b=$t(a);if(b.hasClass("expanded"))$t(a).removeClass("expanded").find(".more-replies-container").html("");else{b.addClass("expanded",!0);var c=b.find(".reply:first").attr("id").replace("post-","");$.ajax({url:"/scripts/threads/getreplies",type:"POST",data:{thread_id:a,from_id:c}}).done(function(b){b=$(b),b.find(".datetime").localizeTimestamp(this),$t(a).find(".more-replies-container").html(b)}).fail(ajaxError)}}function getNewReplies(a,b){if(loadingReplies)return!1;loadingReplies=!0,"undefined"==typeof b&&(b=!1),b&&(updateCount=0,updateRunning&&(stopAutoUpdate(),startAutoUpdate()));var c=$t(a),d=c.find(".reply:last").attr("id");d="undefined"==typeof d?0:d.replace("post-",""),$.ajax({url:"/scripts/threads/getreplies",type:"POST",data:{thread_id:a,from_id:d,newest:!0}}).done(function(a){b&&0==a.length&&toastr.info(messages.noNewReplies),a=$(a),a.find(".datetime").localizeTimestamp(this),lastUpdateNewReplies=a.find(".message").length,newReplies+=lastUpdateNewReplies,a.appendTo(c.find(".replies"))}).fail(function(a,b,c){ajaxError(a,b,c),stopAutoUpdate()}).always(function(){setTimeout("loadingReplies = false",100),updateAutoUpdateVars()})}function updateAutoUpdateVars(){if(0==lastUpdateNewReplies?++updateCount:updateCount=0,!document.hasFocus()&&newReplies>0&&$("body").hasClass("thread-page")){document.title="("+newReplies+") "+documentTitle;var a=$(".replies");a.find("hr").remove(),a.find(".reply:eq(-"+newReplies+")").before("<hr>")}else 0!=newReplies&&(newReplies=0)}function startAutoUpdate(){getNewReplies(thread);var a=2e3;return a*=0==updateCount?1:updateCount,a>3e4&&(a=3e4),!(updateCount>40)&&void(nextUpdateTimeout=setTimeout(function(){startAutoUpdate()},a))}function stopAutoUpdate(){clearTimeout(nextUpdateTimeout)}function showPostForm(a){"undefined"==typeof a&&(a=!1),a||resetPostForm();var b=$("#post-form");b.addClass("visible");var c=$("#post-message");c.is(":visible")&&c.focus()}function hidePostForm(){$("#post-form").removeClass("visible")}function resetPostForm(){var a=$("#post-form");a[0].reset(),a.insertAfter(postformLocation),removePostFile(),resetOriginalPostFormDestination(),hidePostForm()}function addBbCode(a){$("#post-message").insertAtCaret("["+a+"]","[/"+a+"]")}function toggleBbColorBar(){$("#color-buttons").toggle(),$("#post-message").focus()}function replyToThread(a){var b=$("#post-form");b.appendTo("#thread-"+a+" .thread-content"),showPostForm(!0),saveOriginalPostFormDestination(),$("#post-destination").attr("name","thread").val(b.closest(".thread").data("id")),$("#post-message").focus()}function replyToPost(a,b){var c=getSelectionText();"undefined"==typeof b&&(b=!0);var d=$("#post-form");d.appendTo("#post-"+a),showPostForm(!0),saveOriginalPostFormDestination(),$("#post-destination").attr("name","thread").val(d.closest(".thread").data("id"));var e=$("#post-message");e.focus();var f="";"\n"==e.val().substr(-1)?f+="\n":0!=e.val().length&&b&&(f+="\n\n"),f+=">>"+a+"\n",""!=c&&(f+=">"+c.replace(/(\r\n|\n|\r)/g,"$1>")+"\n"),e.val(e.val().trim()+f)}function saveOriginalPostFormDestination(){var a=$("#post-destination");return $("#label-board").is("*")?($("#label-board").hide().find("select").removeAttr("required"),!0):"undefined"!=typeof a.data("orig-name")||(a.data("orig-name",a.attr("name")),a.data("orig-value",a.val()),!0)}function resetOriginalPostFormDestination(){var a=$("#post-destination");return $("#label-board").is("*")&&($("#label-board").show().find("select").attr("required",!0),a.removeAttr("name").removeAttr("value")),"undefined"==typeof a.data("orig-name")||(a.attr("name",a.data("orig-name")),a.val(a.data("orig-value")),!0)}function removePostFile(){$("#post-files").val(""),$("#file-id").val(""),$("#file-name").val(""),$("#post-form").find(".progressbar").each(function(){updateProgressBar($(this),0)}),null!==fileUploadXhr&&fileUploadXhr.abort()}function renderCaptcha(){grecaptcha.render("post-form-captcha",{sitekey:config.reCaptchaPublicKey})}function submitPost(a){if("undefined"!=typeof a&&a.preventDefault(),!("FormData"in window))return toastr.error(messages.oldBrowserWarning,messages.errorOccurred),!1;var b=$("#post-form"),c=b.find('input[type="submit"].button');if(fileUploadInProgress)return c.attr("disabled",!0),b.data("do-submit","true"),!1;if(submitInProgress)return!1;submitInProgress=!0,b.find("#post-files").val("");var d=new FormData(b[0]);$.ajax({url:b.attr("action"),type:"POST",processData:!1,contentType:!1,data:d}).done(function(a){var d,c=$("#post-destination");d="thread"!=c.attr("name")?null:c.val(),null!=d?(toastr.success(messages.postSent),getNewReplies(d,!0)):0==a.length?pageReload():(a=JSON.parse(a),"undefined"==typeof a.message?toastr.error(messages.errorOccurred):window.location="/"+b.find('[name="board"]').val()+"/"+a.message),resetPostForm()}).fail(ajaxError).always(function(){c.removeAttr("disabled"),submitInProgress=!1,"undefined"!=typeof grecaptcha&&grecaptcha.reset()})}function updateProgressBar(a,b){b<0?b=0:b>100&&(b=100),0==b?a.find("div").css("width",0).removeClass("in-progress"):a.find("div").css("width",b+"%").addClass("in-progress")}function playMedia(a,b){b.preventDefault(),stopAllMedia();var c=$(a),d=c.parent(),e=d.parent(".message"),f=c.find("img"),g=d.data("id");if("undefined"!=typeof c.data("loading"))return!1;c.data("loading","true");var h=setTimeout(function(){f.after(loadingAnimation("overlay bottom left"))},200);$.ajax({url:"/scripts/files/getmediaplayer",type:"POST",data:{file_id:g}}).done(function(a,b,c){d.removeClass("thumbnail").addClass("media-player-container"),e.addClass("full"),d.prepend(a);var f=getStoredVal("videoVolume");null!=f&&d.find("video").prop("volume",f)}).fail(ajaxError).always(function(){clearTimeout(h),d.find(".loading").remove(),c.removeData("loading")})}function stopAllMedia(){$(".media-player-container").each(function(){var a=$(this),b=a.find(".media-player");b.find("video").trigger("pause"),b.remove(),a.removeClass("media-player-container").addClass("thumbnail")})}function saveVolume(a){storeVal("videoVolume",$(a).prop("volume"))}function expandImage(a,b){b.preventDefault();var c=$(a).parent(),d=c.parent(".message"),e=$(a).find("img");if("undefined"!=typeof e.data("expanding"))return!0;d.addClass("full"),"undefined"==typeof e.data("orig-src")?(e.data("orig-src",e.attr("src")),changeSrc(e,c.find("figcaption a").attr("href")),c.removeClass("thumbnail")):(changeSrc(e,e.data("orig-src")),e.removeData("orig-src"),c.addClass("thumbnail"));var f=c.offset().top;$(document).scrollTop()>f&&$(document).scrollTop(f)}function changeSrc(a,b){a.data("expanding","true");var c=setTimeout(function(){a.after(loadingAnimation("overlay center"))},200);a.attr("src",b).on("load",function(){a.removeData("expanding"),clearTimeout(c),a.parent().find(".loading").remove()})}function destroySession(a){$.ajax({url:"/scripts/user/destroysession",type:"POST",data:{session_id:a}}).done(function(b,c,d){$("#"+a).fadeOut()}).fail(ajaxError)}function changeUsername(a){a.preventDefault();var b=$(a.target),c=b.find('input[name="newname"]').val(),d=b.find('input[name="password"]').val();$.ajax({url:b.attr("action"),type:"POST",data:{new_name:c,password:d}}).done(function(a,b,c){pageReload()}).fail(ajaxError)}function changePassword(a){a.preventDefault();var b=$(a.target),c=b.find('input[name="newpass"]').val(),d=b.find('input[name="newpassre"]').val(),e=b.find('input[name="password"]').val();return c!=d?(toastr.error(messages.passwordsDoNotMatch),!1):void $.ajax({url:b.attr("action"),type:"POST",data:{new_password:c,password:e}}).done(function(b,c,d){toastr.success(messages.passwordChanged),a.target.reset()}).fail(ajaxError)}function switchThemeVariation(){var a=$(".css:last"),b=a.data("alt"),c=a.data("cur-alt").toString();if("undefined"==typeof b)return!1;var d=Object.keys(b),e=d[($.inArray(c,d)+1)%d.length];"undefined"==typeof d[e]&&(e=0);var f=a.attr("href"),g=f.replace(b[c],b[d[e]]);if(g==f)return!0;$("<link>").attr({rel:"stylesheet",class:"css",href:g,"data-alt":JSON.stringify(b),"data-cur-alt":e}).insertAfter(a);var h=setTimeout(function(){$(".css:first").remove()},2e3);$.ajax({url:"/scripts/preferences/setthemevariation",type:"POST",data:{id:e}}).fail(function(a,b,c){ajaxError(a,b,c),clearTimeout(h)})}function toggleHideSidebar(){$("#hide-sidebar").is("*")?($("#hide-sidebar").remove(),$("#sidebar").removeClass("visible")):$("<link>").attr({rel:"stylesheet",id:"hide-sidebar",href:config.staticUrl+"/css/hide_sidebar.css"}).appendTo("head"),$.ajax({url:"/scripts/preferences/togglehidesidebar",type:"POST"}).fail(ajaxError)}function toggleSidebar(){$("#sidebar").toggleClass("visible")}function searchCatalog(a){var b=$(".thread-box");0==a.length?b.show():(b.hide(),b.each(function(){var b=$(this);return b.find("h3").html().toLowerCase().indexOf(a.toLowerCase())!==-1?($(this).show(),!0):b.find(".post").html().toLowerCase().indexOf(a.toLowerCase())!==-1?($(this).show(),!0):void 0}))}function highlightPost(a){$(a).addClass("highlighted")}function removeHighlights(){$(".highlighted").removeClass("highlighted")}function pageReload(){window.location=window.location.href.split("#")[0]}function returnToBoard(){var a=window.location.href;a=a.substr(0,a.lastIndexOf("/")+1),window.location=a}function ajaxError(a,b,c){var d=getErrorMessage(a,c);"418"==a.status?toastr.info(d):0!=d.length?toastr.error(d,messages.errorOccurred):toastr.error(messages.errorOccurred)}function getErrorMessage(a,b){if("timeout"==b)b=messages.timeoutWarning;else try{var c=JSON.parse(a.responseText);b=c.message}catch(c){b=a.status+" "+b}return 0==b.length&&0==a.readyState&&0==a.status&&(b=messages.networkError),b}function loadingAnimation(a){return"undefined"==typeof a?a="":a+=" ",'<span class="'+a+'loading icon-loading spin"></span>'}function getSelectionText(){var a="";return window.getSelection?a=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(a=document.selection.createRange().text),a}function $t(a){return $("#thread-"+a)}function $p(a){return $("#post-"+a)}function oldBrowserWarning(){toastr.warning(messages.oldBrowserWarning)}function confirmUnload(){var a=$("#post-message");return!submitInProgress&&a.is(":visible")&&0!=a.val().length?messages.confirmUnload:void(e=null)}function storeVal(a,b){return"undefined"==typeof localStorage?(oldBrowserWarning(),!1):localStorage.setItem(a,b)}function getStoredVal(a){return"undefined"==typeof localStorage?(oldBrowserWarning(),!1):localStorage.getItem(a)}function removeStoredVal(a){return"undefined"==typeof localStorage?(oldBrowserWarning(),!1):localStorage.removeItem(a)}$.ajaxSetup({cache:!1,headers:{"X-CSRF-Token":config.csrfToken}}),jQuery.fn.extend({insertAtCaret:function(a,b){return"undefined"==typeof b&&(b=""),this.each(function(){if(document.selection){var c=document.selection.createRange();c.text=a+c.text+b,this.focus()}else if(this.selectionStart||"0"==this.selectionStart){var d=this.value.substr(this.selectionStart,this.selectionEnd-this.selectionStart),e=this.selectionStart,f=this.selectionEnd;this.value=this.value.substr(0,e)+a+d+b+this.value.substr(f,this.value.length),this.selectionStart=e+a.length,this.selectionEnd=e+a.length,this.focus()}else this.value+=a+b,this.focus()})},localizeTimestamp:function(){return this.each(function(){this.innerHTML=new Date(this.innerHTML.replace(" ","T")+"Z").toLocaleString()})},localizeNumber:function(){return this.each(function(){this.innerHTML=parseFloat(this.innerHTML).toLocaleString()})},localizeCurrency:function(){return this.each(function(){this.innerHTML=parseFloat(this.innerHTML).toLocaleString(!0,{style:"currency",currency:"eur"})})}}),jQuery.fn.reverse=[].reverse,$(".mod-menu").tooltipster({content:loadingAnimation(),side:"bottom",animationDuration:0,updateAnimation:null,delay:0,arrow:!1,contentAsHTML:!0,zIndex:1001,trigger:"click",interactive:"true",functionInit:function(a,b){var c=$(b.origin).next(".mod-menu-html").show().detach();a.content(c)}});var newReplies=0,lastUpdateNewReplies=0,updateCount=0,loadingReplies=!1,updateRunning=!1,nextUpdateTimeout=!1,documentTitle=document.title;if($("body").hasClass("thread-page")){var thread=$(".thread:first").data("id");$(window).on("scroll",function(){var a=$(window).height()+$(window).scrollTop(),b=$(".replies").offset().top+$(".replies").height();a>b?updateRunning||$("#post-message").is(":focus")||(updateRunning=!0,startAutoUpdate()):updateRunning&&(stopAutoUpdate(),updateRunning=!1)}).on("focus",function(){newReplies=0,updateCount=0,document.title!=documentTitle&&(document.title=documentTitle)});var startTimeout;$("#post-message").on("focus",function(){clearTimeout(startTimeout),stopAutoUpdate()}).on("blur",function(){startTimeout=setTimeout("startAutoUpdate()",500)})}var postformLocation=$("#post-form").prev(),fileUploadInProgress=!1,fileUploadXhr=null;$("#post-files").on("change",function(a){if(!("FormData"in window))return toastr.error(messages.oldBrowserWarning,messages.errorOccurred),!1;var b=$(a.target),c=$(this),d=c.parent().parent(".input-row").next(".file-progress");$("#file-name").val(""),b.removeData("do-submit"),null!==fileUploadXhr&&fileUploadXhr.abort(),d.find("div").css("width","1%");for(var i,e=c.data("maxsize"),f=c[0].files,g=0,h=0;i=f[h];h++)g+=i.size;if(g>e)return toastr.warning(messages.maxSizeExceeded),!1;var j=new FormData;j.append("file",this.files[0]),fileUploadInProgress=!0;var k=$("#post-files").val().split("\\").pop().split(".");k.pop(),$("#file-name").val(k.join(".")),fileUploadXhr=$.ajax({url:"/scripts/files/upload",type:"POST",processData:!1,contentType:!1,data:j,xhr:function(){var a=$.ajaxSettings.xhr();return a.upload?(a.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=Math.round(a.loaded/a.total*100);b<1?b=1:b>95&&(b=95),updateProgressBar(d,b)}},!1),a):a}}).always(function(){fileUploadInProgress=!1}).done(function(a){updateProgressBar(d,100),a=JSON.parse(a),0!=a.message.length?($("#file-id").val(a.message),"undefined"!=typeof $("#post-form").data("do-submit")&&submitPost()):(toastr.error(messages.errorOccurred),updateProgressBar(d,0))}).fail(function(a,b,c){ajaxError(a,b,c),updateProgressBar(d,0)})});var submitInProgress;$(".datetime").localizeTimestamp(),$(".number").localizeNumber(),$(".currency").localizeCurrency();var reflinkCreateTimeout;$("body:not(.board-catalog)").on("touchstart",".spoiler:not(.spoiled)",function(a){a.preventDefault(),$(this).addClass("spoiled")}).on("click",function(a){$(".spoiler.spoiled").removeClass("spoiled")}).on("contextmenu",".reflink",function(a){a.preventDefault()}).on("touchstart mouseenter",".reflink:not(.tooltipstered)",function(a){var b=$(this);reflinkCreateTimeout=setTimeout(function(){a.preventDefault();var c=b.data("id"),d=loadingAnimation();$p(c).is("*")&&(d=$p(c).html()),b.tooltipster({content:d,side:"bottom",animationDuration:0,updateAnimation:null,delay:0,arrow:!1,contentAsHTML:!0,theme:"thread",trigger:"custom",triggerOpen:{mouseenter:!0,touchstart:!0},triggerClose:{mouseleave:!0,click:!0},functionInit:function(a,b){var c=$(b.origin).data("id");$.ajax({url:"/scripts/posts/get",type:"POST",data:{post_id:c}}).done(function(b){b=$(b),b.find(".datetime").localizeTimestamp(this),a.content(b)}).fail(function(b,c,d){var e=getErrorMessage(b,d);a.content(e)})}}).tooltipster("open")},100)}).on("touchend mouseleave",".reflink:not(.tooltipstered)",function(a){clearTimeout(reflinkCreateTimeout)}).on("click",":not(.tooltipster-base) .reflink",function(a){var b=$(this).data("id");$p(b).is("*")&&(a.preventDefault(),window.location=window.location.href.split("#")[0]+"#post-"+b)}),$(".tooltip").tooltipster({side:"bottom",animationDuration:0,delay:0,trigger:"click"}),$("#sidebar").click(function(a){a.offsetX>$("#sidebar").innerWidth()&&toggleSidebar()}),$("body >:not(#topbar):not(#sidebar)").on("click",function(a){$("#sidebar.visible").removeClass("visible")}),$(window).on("beforeunload",function(a){return confirmUnload(a)}).on("hashchange load",function(a){if("hashchange"==a.type&&removeHighlights(),0!=window.location.hash.length&&(highlightPost(window.location.hash),$("#topbar").is(":visible"))){var b=$(window.location.hash);$(window).scrollTop(b.offset().top-$("#topbar").height())}}).on("keydown",function(a){return 116!=a.which||a.ctrlKey?82==a.which&&a.ctrlKey&&!a.shiftKey?(pageReload(),!1):void 0:(pageReload(),!1)});
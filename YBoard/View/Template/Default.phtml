<?php header('Content-Type: text/html; charset=utf-8'); ?>
<!doctype html>
<html>
<head>
    <title><?= htmlspecialchars($this->getTitle()) ?></title>

    <meta charset="UTF-8">

    <meta name="robots" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#117743">

    <base href="<?= $baseUrl ?>">

    <link rel="stylesheet" class="css" href="<?= $staticUrl ?>/css/<?= $stylesheet ?>.css?<?=time()?>"
        data-cur-alt="<?= $stylesheetVariation ?>" data-alt='<?= $altStylesheets ?>'>
    <?php if ($user->preferences->hideSidebar) : ?>
    <link rel="stylesheet" id="hide-sidebar" href="<?= $staticUrl ?>/css/hide_sidebar.css">
    <?php endif ?>

    <link rel="icon" sizes="192x192" href="<?= $staticUrl ?>/img/norppa_icon.png">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.2/toastr.min.js"></script>
    <script src="<?= $staticUrl ?>/js/tooltipster.min.js"></script>

    <script src="<?= $staticUrl ?>/js/scripts.js?<?=time()?>" defer></script>
    <script>
        <?php // TODO: Move to external file? (Pros: can cache, Cons: requires loading everything twice) ?>
        var config = {
            staticUrl: '<?= $staticUrl ?>',
            csrfToken: '<?= $csrfToken ?>',
            reCaptchaPublicKey: '<?= $reCaptchaPublicKey ?>',
        };
        var messages = {
            loading: '<?= _('Loading...') ?>',
            errorOccurred: '<?= _('An error occurred') ?>',
            timeoutWarning: '<?= _('Loading timed out, please check your internet connection') ?>',
            networkError: '<?= _('Network error, please check that you are connected to the internet') ?>',
            logOutConfirm: '<?= _('Log out?') ?>',
            signUp: '<?= _('Sign up') ?>',
            cancel: '<?= _('Cancel') ?>',
            logIn: '<?= _('Log_in') ?>',
            maxSizeExceeded: '<?= _('Your files exceed the maximum upload size.') ?>',
            confirmDeletePost: '<?= _('Delete post?') ?>',
            confirmDeleteFile: '<?= _('Delete file?') ?>',
            postSent: '<?= _('Post sent') ?>',
            postDeleted: '<?= _('Post deleted') ?>',
            fileDeleted: '<?= _('File deleted') ?>',
            postReported: '<?= _('Post reported') ?>',
            threadLocked: '<?= _('Thread locked') ?>',
            threadUnlocked: '<?= _('Thread unlocked') ?>',
            threadStickied: '<?= _('Thread stickied') ?>',
            threadUnstickied: '<?= _('Thread unstickied') ?>',
            confirmUnload: '<?= _('Your message will be lost.') ?>',
            noNewReplies: '<?= _('No new replies') ?>',
            showFullMessage: '<?= _('show full message') ?>',
            passwordsDoNotMatch: '<?= _('The two passwords do not match') ?>',
            passwordChanged: '<?= _('Password changed') ?>',
            oldBrowserWarning: '<?= _('You are using an outdated browser which does not support some modern techniques used by this website. Please upgrade your browser.') ?>',
        };
    </script>
    <?php if ($user->requireCaptcha) : ?>
    <script src="//www.google.com/recaptcha/api.js?render=explicit&amp;onload=renderCaptcha" async defer></script>
    <?php endif ?>
</head>
<body<?= (!empty($bodyClass)?' class="' . $bodyClass . '"':'') ?>>

<div id="topbar">
    <button class="sidebar-toggle" onclick="toggleSidebar()"><span class="icon-menu"></span><?= _('Menu') ?></button>
    <div class="buttons"
        ><button id="notifications-button" onclick="getNotifications(this)" class="icon-alarm" title="<?= _('Notifications') ?>"
            ><span class="unread-notifications unread-count red<?= ($user->notifications->unreadCount==0?' none':'') ?>"
            ><?= $user->notifications->unreadCount ?></span></button
        ><a href="/followedthreads/" class="icon-bookmark2" title="<?= _('Followed threads') ?>"><?php
            if($user->threadFollow->unreadCount != 0) :
                ?><span class="unread-count green"><?= $user->threadFollow->unreadCount ?></span><?php
            endif ?></a
        ><button onclick="$(document).scrollTop($('body').height())" class="icon-enter-down2" title="<?= _('Go to bottom') ?>"></button
        ><button onclick="$(document).scrollTop(0)" class="icon-enter-up2" title="<?= _('Back to top') ?>"></button
        ><button onclick="pageReload()" class="icon-sync" title="<?= _('Refresh page') ?>"></button
    ></div>
</div>

<div id="sidebar">
    <button id="sidebar-hide-button" onclick="toggleHideSidebar()"></button>
    <nav id="main">
        <a href="/" id="logo">
            <img src="<?= $staticUrl ?>/img/norppa_ylilauta.svg" alt="<?= htmlspecialchars($siteName) ?>">
            <span><?= htmlspecialchars($siteName) ?></span>
        </a>
        <div class="columns">
            <a href="/gold"><?= _('Gold account') ?></a>
            <a href="/faq"><?= _('FAQ') ?></a>
            <a href="/rules"><?= _('Rules') ?></a>
            <a href="/about"><?= _('About') ?></a>
            <a href="/advertising"><?= _('Advertising') ?></a>
        </div>
        <form id="search" method="get" action="/search">
            <input name="cx" value="<?= $gCsePartnerPub ?>" type="hidden">
            <input name="cof" value="FORID:10" type="hidden">
            <input name="ie" value="UTF-8" type="hidden">
            <input id="searchfield" name="q" size="24" placeholder="<?= _('Search Ylilauta...') ?>" type="text" required>
            <button id="searchbutton" class="icon-magnifier"></button>
        </form>
    </nav>
    <nav id="user">
    <?php if (!$user->loggedIn) : ?>
        <h3><?= _('Log in') ?></h3>
        <form id="login" action="/scripts/session/login" data-signup="/scripts/session/signup" method="post">
            <input type="hidden" name="csrf_token" value="<?= $csrfToken ?>">
            <input type="hidden" name="redirto" value="<?= htmlspecialchars(empty($redirTo)?$_SERVER['REQUEST_URI']:$redirTo) ?>">
            <input type="text" name="username" placeholder="<?= _('Username') ?>" maxlength="<?= $usernameMaxLength ?>" required>
            <input type="password" name="password" placeholder="<?= _('Password') ?>" required>
            <div id="signup-form">
                <input type="password" name="repassword" placeholder="<?= _('Password again') ?>">
                <div id="signup-captcha"></div>
            </div>
            <input type="submit" class="button primary" name="login" id="loginbutton" value="<?= _('Log_in') ?>">
            <button onclick="signupForm(this, event)" class="button transparent" data-open="false"><?= _('Sign up') ?></button>
        </form>
    <?php else : ?>
        <h3><?= htmlspecialchars($user->username) ?></h3>
    <?php endif ?>
        <div class="buttons">
            <button onclick="getNotifications(this)" class="button square icon-alarm" title="<?= _('Notifications') ?>"
                ><span class="unread-notifications unread-count red<?= ($user->notifications->unreadCount==0?' none':'') ?>"
                ><?= $user->notifications->unreadCount ?></span></button>
            <a href="/followedthreads/" class="button square icon-bookmark2" title="<?= _('Followed threads') ?>"><?php
                if($user->threadFollow->unreadCount != 0) :
                    ?><span class="unread-count green"><?= $user->threadFollow->unreadCount ?></span><?php
                endif
            ?></a>
            <?php if ($user->isMod) : ?>
                <a class="button square icon-flag2" href="/mod/reports" title="<?= _('Reports') ?>"
                    ><span class="unread-count red"><?= $uncheckedReports ?></span></a>
            <?php endif ?>
            <a class="button square icon-user" href="/profile/" title="<?= _('Profile') ?>"></a>
            <a class="button square icon-cog" href="/preferences" title="<?= _('Preferences') ?>"></a>
            <button class="button square icon-lamp" onclick="switchThemeVariation()" title="<?= _('Switch theme colors') ?>"></button>
            <?php if ($user->loggedIn) : ?>
                <form id="logout" action="/scripts/session/logout" method="post">
                    <input type="hidden" name="csrf_token" value="<?= $csrfToken ?>">
                    <button type="submit" class="button square icon-exit" title="<?= _('Log out') ?>"
                        onclick="if(!confirm(messages.logOutConfirm)){return false}"></button>
                </form>
            <?php endif ?>
        </div>
        <div class="columns">
            <a href="/mythreads/"><?= _('My threads') ?></a>
            <a href="/repliedthreads/"><?= _('Replied threads') ?></a>
            <a href="/hiddenthreads/"><?= _('Hidden threads') ?></a>
        </div>
    </nav>
    <nav id="boards">
        <h3><?= _('Discussion boards') ?></h3>
        <div class="columns">
    <?php foreach($boardList as $board) : ?>
        <a href="/<?= htmlspecialchars($board->url) ?>/"
            <?= ($board->isNsfw?' class="nsfwboard"':'') ?>><?= htmlspecialchars($board->name) ?><?php if($board->isNsfw) :
            ?><span class="text-tag nsfw"><?= _('NSFW') ?></span><?php endif ?></a>
    <?php endforeach ?>
        </div>
    </nav>
</div>
<div id="content">
    <?= $output ?>
</div>
</body>
</html>

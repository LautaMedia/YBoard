<?php header('Content-Type: text/html; charset=utf-8'); ?>
<!doctype html>
<html>
<head>
    <title><?= htmlspecialchars($this->getTitle()) ?></title>

    <meta charset="UTF-8">

    <meta name="robots" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <base href="<?= $baseUrl ?>">

    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:100,100italic,300,300italic,400,400italic,700,700italic">
    <link rel="stylesheet" href="<?= $staticUrl ?>/css/ylilauta.css">
    <link rel="icon" href="<?= $staticUrl ?>/img/favicon.png">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.2/toastr.min.js"></script>

    <script defer src="<?= $staticUrl ?>/js/scripts.js"></script>
    <script>
        var config = {
            csrfToken: '<?= $csrfToken ?>',
            reCaptchaPublicKey: '<?= $reCaptchaPublicKey ?>',
        };
        var messages = {
            errorOccurred: '<?= _('An error occurred') ?>',
            signUp: '<?= _('Sign up') ?>',
            cancel: '<?= _('Cancel') ?>',
            logIn: '<?= _('Log_in') ?>',
            maxSizeExceeded: '<?= _('Your files exceed the maximum upload size.') ?>',
            messageSent: '<?= _('Message sent') ?>',
        };
        <?php // TODO: Move to external file? ?>
    </script>
    <?php if (!$user->loggedIn) : ?>
    <script src="//www.google.com/recaptcha/api.js?render=explicit" async defer></script>
    <?php endif ?>
</head>
<body<?= (!empty($bodyClass)?' class="' . $bodyClass . '"':'') ?>>
<div id="sidebar">
    <nav id="main">
        <a href="/" id="logo"><img src="<?= $staticUrl ?>/img/norppa_ylilauta.svg" alt="<?= htmlspecialchars($siteName) ?>"><?= htmlspecialchars($siteName) ?></a>
        <a href="/gold"><?= _('Gold account') ?></a>
        <a href="/faq"><?= _('FAQ') ?></a>
        <a href="/rules"><?= _('Rules') ?></a>
        <a href="/about"><?= _('About') ?></a>
        <a href="/advertising"><?= _('Advertising') ?></a>

        <form id="search" action="/search" id="cse-search-box2">
            <input name="cx" value="partner-pub-8488309688101323:6580750696" type="hidden">
            <input name="cof" value="FORID:10" type="hidden">
            <input name="ie" value="UTF-8" type="hidden">
            <input id="searchfield" name="q" size="24" placeholder="<?= _('Search Ylilauta...') ?>" type="text" required>
            <input id="searchbutton" value="Â»" type="submit">
        </form>
    </nav>
    <nav id="user">
    <?php if (!$user->loggedIn) : ?>
        <h3><?= _('Log in') ?></h3>
        <form id="login" action="/login" method="post">
            <input type="hidden" name="csrf_token" value="<?= $csrfToken ?>">
            <input type="hidden" name="redirto" value="<?= htmlspecialchars(empty($redirTo)?$_SERVER['REQUEST_URI']:$redirTo) ?>">
            <input type="text" name="username" placeholder="<?= _('Username') ?>" required>
            <input type="password" name="password" placeholder="<?= _('Password') ?>" required>
            <div id="signupform">
                <input type="password" name="repassword" placeholder="<?= _('Password again') ?>">
                <div id="signup-captcha"></div>
            </div>
            <input type="submit" class="button green" name="login" id="loginbutton" value="<?= _('Log_in') ?>">
            <button onclick="signupForm(this, event)" class="button transparent" data-open="false"><?= _('Sign up') ?></button>
        </form>
    <?php else : ?>
        <h3><a href="/profile"><?= htmlspecialchars($user->username) ?></a></h3>
        <a href="/preferences"><?= _('Preferences') ?></a>
        <form id="logout" action="/logout" method="post">
            <input type="hidden" name="csrf_token" value="<?= $csrfToken ?>">
            <input type="submit" class="link" value="<?= _('Log out') ?>">
        </form>
    <?php endif ?>
    </nav>
    <nav id="boards">
        <h3><?= _('Discussion boards') ?></h3>
    <?php foreach($boardList as $board) : ?>
        <a href="/<?= htmlspecialchars($board->url) ?>/"
            <?= ($board->nsfw?' class="nsfwboard"':'') ?>><?= htmlspecialchars($board->name) ?><?php if($board->nsfw) :
            ?><span class="text-tag nsfw"><?= _('NSFW') ?></span><?php endif ?></a>
    <?php endforeach ?>
    </nav>
</div>
<div id="content">
    <?= $output ?>
</div>
</body>
</html>
